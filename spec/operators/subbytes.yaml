version: 0.1

operator:
  name: SubBytes
  module_name: SubBytesLLMAuto
  package: crypto.aes.llm.auto
  category: aes
  description: >
    AES-128 SubBytes transformation.
    The input and output are 128-bit AES state values, interpreted
    as a 4x4 byte matrix in column-major order, as in FIPS-197.

  io:
    clock: implicit
    reset: implicit
    inputs:
      - name: state_in
        width: 128
        signed: false
        description: >
          AES 128-bit state input (4x4 bytes, column-major).
    outputs:
      - name: state_out
        width: 128
        signed: false
        description: >
          AES 128-bit state output after byte-wise S-Box substitution.

  timing:
    combinational: true
    latency_cycles: 0

  behavior:
    kind: stateless_pure
    aes_state_layout: column_major
    description: |
      Apply the AES SubBytes transformation to each of the 16 bytes
      of the state. Each byte is replaced by the corresponding entry
      in the AES S-Box defined in FIPS-197.
    pseudocode: |
      for i in 0 .. 15:
          state_out_byte[i] = AES_SBOX[state_in_byte[i]]

  # üî• Êñ∞Â¢ûÔºöÁªô LLM ÁöÑ‰∏ìÁî®ÊèêÁ§∫
  llm:
    extra_imports:
      - crypto.aes.AesSBoxConst

    implementation_hint: |
      IMPORTANT:
        - AesSBoxConst.table is a Scala Seq[Int], NOT a hardware Vec.
        - You MUST convert AesSBoxConst.table to a Vec[UInt(8.W)] FIRST:
          
            val sbox = VecInit(AesSBoxConst.table.map(_.U(8.W)))

      IO must be EXACTLY:

        val io = IO(new Bundle {
          val state_in  = Input(UInt(128.W))
          val state_out = Output(UInt(128.W))
        })

      Correct byte extraction (16 bytes):

        val inBytes = Wire(Vec(16, UInt(8.W)))
        for (i <- 0 until 16) {
          inBytes(i) := io.state_in(8*(i+1)-1, 8*i)
        }

      S-Box lookup:

        val outBytes = Wire(Vec(16, UInt(8.W)))
        for (i <- 0 until 16) {
          outBytes(i) := sbox(inBytes(i))
        }

      Assemble output:

        io.state_out := Cat(outBytes.reverse)

      STRICT RULES:
        - DO NOT use Bits(), SInt(), Signed().
        - DO NOT use asTypeOf(Vec(...)).
        - ONLY use UInt.
        - Use VecInit and Cat EXACTLY as described above.
        - Do NOT define your own S-Box.
        - ALWAYS use AesSBoxConst.table through a VecInit conversion.
